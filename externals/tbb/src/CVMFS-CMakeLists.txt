include ("${EXTERNALS_LIB_LOCATION}/CMake-Register_External_Lib.txt")

set (TBB_PRIVATE_LIB_SUFFIX "_cvmfs")
set (TBB_LIBRARY             "libtbb${TBB_PRIVATE_LIB_SUFFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
set (TBBMALLOC_LIBRARY       "libtbbmalloc${TBB_PRIVATE_LIB_SUFFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
set (TBB_LIBRARY_DEBUG       "libtbb${TBB_PRIVATE_LIB_SUFFIX}_debug${CMAKE_SHARED_LIBRARY_SUFFIX}")
set (TBBMALLOC_LIBRARY_DEBUG "libtbbmalloc${TBB_PRIVATE_LIB_SUFFIX}_debug${CMAKE_SHARED_LIBRARY_SUFFIX}")

set (TBB_LIBRARY_DIRS        "${TBB_BUILD_LOCATION}/build_release")
set (TBB_DEBUG_LIBRARY_DIRS  "${TBB_BUILD_LOCATION}/build_debug")

set (TBB_LIBRARIES           ${TBB_LIBRARY_DIRS}/${TBB_LIBRARY}
                             ${TBB_LIBRARY_DIRS}/${TBBMALLOC_LIBRARY})
set (TBB_DEBUG_LIBRARIES     ${TBB_DEBUG_LIBRARY_DIRS}/${TBB_LIBRARY_DEBUG}
                             ${TBB_DEBUG_LIBRARY_DIRS}/${TBBMALLOC_LIBRARY_DEBUG})

if (NOT MACOSX)
  set (TBB_LIBRARIES       ${TBB_LIBRARIES}       ${TBB_LIBRARY_DIRS}/${TBB_LIBRARY}.2
                                                  ${TBB_LIBRARY_DIRS}/${TBBMALLOC_LIBRARY}.2)
  set (TBB_DEBUG_LIBRARIES ${TBB_DEBUG_LIBRARIES} ${TBB_DEBUG_LIBRARY_DIRS}/${TBB_LIBRARY_DEBUG}.2
                                                  ${TBB_DEBUG_LIBRARY_DIRS}/${TBBMALLOC_LIBRARY_DEBUG}.2)
endif (NOT MACOSX)

list (GET TBB_LIBRARIES 0 TBB_MAIN_LIB)
register_external_lib (libtbb ${TBB_BUILD_LOCATION} ${TBB_MAIN_LIB})

if (IS_64_BIT)
  set (TBB_INSTALL_LOCATION "lib64")
else (IS_64_BIT)
  set (TBB_INSTALL_LOCATION "lib")
endif (IS_64_BIT)

install (
  FILES          ${TBB_LIBRARIES} ${TBB_DEBUG_LIBRARIES}
  DESTINATION    ${TBB_INSTALL_LOCATION}
  PERMISSIONS    OWNER_READ OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
)
